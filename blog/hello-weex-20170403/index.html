<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="Website Description">

<base href="/">
<title>


     初见 Weex 

</title>
<link rel="canonical" href="/blog/hello-weex-20170403/">








<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>




<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.0/jquery.scrollTo.min.js">

<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500|Work+Sans">



    
    <link rel="stylesheet" href="/css/style.css?t=1491233767">
    



<link rel="stylesheet" href="/css/card.css">


<link rel="shortcut icon"

    href="/img/fav.ico"

>








</head>

<body lang="en">
  

<div class="section" id="top">

    <div class="container hero fade-in one">
    <h1 class="title is-1">计轶轩的博客</h1>
    </div>


<div class="section fade-in two">

    <div class="container">
    <hr>
<nav class="nav nav-center">
    <span id="nav-toggle" class="nav-toggle"  onclick="document.getElementById('nav-menu').classList.toggle('is-active');">
      <span></span>
      <span></span>
      <span></span>
    </span>
    <div id="nav-menu" class="nav-left nav-menu">
      <span class="nav-item">
        <a href="/">首页</a>
      </span>
      <span class="nav-item">
        <a href="/#about">简历</a> 
      </span>
    
    
      <span class="nav-item">
        <a href="/blog">博客</a>
      </span> 
    
      <span class="nav-item">
        <a href="/#contact">联系我</a>
      </span>
    
      <span class="nav-item">
        <a href="/index.xml"><i class="fa fa-rss"></i></a>
      </span>
    
    </div>
</nav>
<hr>
    </div>

    <div class="container fade-in two">
        <h2 class="title is-1 top-pad strong-post-title"><a href="/blog/hello-weex-20170403/">初见 Weex</a></h2>
            <div class="post-data">
                Apr 3, 2017 |
                4 minutes read
            </div>
            
            
            
    </div>

    <div class="container markdown fade-in two top-pad">
        <p>Weex 是阿里提出的一套跨平台开发方案，追求 Write Once, Run Everywhere。
</p>

<h2 id="初见">初见</h2>

<h3 id="weex-是什么">Weex 是什么？</h3>

<ul>
<li>一套跨平台开发方案（iOS、Android、浏览器三端）</li>
<li>对移动端而言，可以用 web 的开发体验构建高性能、可扩展的 native 应用</li>
<li>支持 Vue.js</li>
</ul>

<h3 id="weex-的目标是什么">Weex 的目标是什么？</h3>

<ul>
<li>Write Once, Run Everywhere.</li>
<li>一套代码同时支持 iOS、Android、浏览器（H5）三端运行</li>
<li>打造三端一致的 native 应用</li>
</ul>

<h3 id="学习-weex-之前-你需要了解什么">学习 Weex 之前，你需要了解什么？</h3>

<ul>
<li>Node.js</li>
<li>HTML + CSS + JavaScript 前端知识</li>
<li>Vue.js 框架</li>
<li>iOS 或 Android Native 知识</li>
</ul>

<h2 id="搭建开发环境">搭建开发环境</h2>

<ul>
<li><a href="http://dotwe.org/vue">dotWe</a> - Weex 在线调试工具</li>
<li>Node.js &amp; npm</li>
<li>weex-toolkit - 一个基于 Node.js 的命令行工具（注：1.0.1 之后才支持初始化 Vue 项目）</li>
</ul>

<h2 id="hello-weex">hello-weex</h2>

<h3 id="新建-weex-工程">新建 Weex 工程</h3>

<pre><code>$ weex init hello-weex

prompt: Init your Project:  (hello-weex)
file: /Users/jiyixuan/weex_workspace/hello-weex/.babelrc created.
file: /Users/jiyixuan/weex_workspace/hello-weex/.eslintrc created.
file: /Users/jiyixuan/weex_workspace/hello-weex/.gitignore created.
file: /Users/jiyixuan/weex_workspace/hello-weex/README.md created.
file: /Users/jiyixuan/weex_workspace/hello-weex/app.js created.
file: /Users/jiyixuan/weex_workspace/hello-weex/assets/phantom-limb.js created.
file: /Users/jiyixuan/weex_workspace/hello-weex/assets/qrcode.js created.
file: /Users/jiyixuan/weex_workspace/hello-weex/assets/qrcode.min.js created.
file: /Users/jiyixuan/weex_workspace/hello-weex/assets/style.css created.
file: /Users/jiyixuan/weex_workspace/hello-weex/assets/url.js created.
file: /Users/jiyixuan/weex_workspace/hello-weex/build/init.js created.
file: /Users/jiyixuan/weex_workspace/hello-weex/index.html created.
file: /Users/jiyixuan/weex_workspace/hello-weex/package.json created.
file: /Users/jiyixuan/weex_workspace/hello-weex/src/foo.vue created.
file: /Users/jiyixuan/weex_workspace/hello-weex/webpack.config.js created.
file: /Users/jiyixuan/weex_workspace/hello-weex/weex.html created.
</code></pre>

<h3 id="weex-工程标准结构">Weex 工程标准结构</h3>

<pre><code>├── README.md
├── app.js
├── assets
│   ├── phantom-limb.js
│   ├── qrcode.js
│   ├── qrcode.min.js
│   ├── style.css
│   └── url.js
├── build
│   └── init.js
├── index.html
├── package.json
├── src
│   └── foo.vue
├── webpack.config.js
└── weex.html
</code></pre>

<h3 id="安装">安装</h3>

<pre><code>$ npm install
</code></pre>

<p>安装成功后，根目录下多出 node_modules 目录。</p>

<h3 id="启动服务">启动服务</h3>

<p>执行 <code>npm run serve</code> 启动一个本地服务，并在浏览器打开 <code>http://localhost:8080/index.html</code> 查看 Weex h5 页面</p>

<pre><code>$ npm run serve

&gt; hello-weex@0.1.0 serve /Users/jiyixuan/weex_workspace/hello-weex
&gt; node build/init.js &amp;&amp; serve -p 8080

serving /Users/jiyixuan/weex_workspace/hello-weex on port 8080
GET /index.html 200 9ms - 1.6kb
GET /config.js 200 3ms - 32
GET /assets/style.css 200 8ms - 1.14kb
GET /assets/url.js 200 5ms - 295
GET /assets/qrcode.js 200 4ms - 48.89kb
GET /node_modules/vue/dist/vue.js 200 5ms - 238.7kb
GET /weex.html 200 1ms - 891
GET /assets/phantom-limb.js 200 6ms - 10.12kb
GET /dist/app.web.js 200 5ms - 15.02kb
GET /node_modules/vue/dist/vue.runtime.js 200 6ms - 172.52kb
GET /node_modules/weex-vue-render/index.js 200 7ms - 713.49kb
GET /weex.html 304 1ms
</code></pre>

<h3 id="hello-weex-for-ios">hello-weex for iOS</h3>

<h4 id="通过-cocoapods-安装-weexsdk">通过 CocoaPods 安装 WeexSDK</h4>

<p>常规做法，没什么要特别说明的。</p>

<h4 id="初始化-weex-环境">初始化 Weex 环境</h4>

<pre><code class="language-Objective-C">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
    // 配置
    [WXAppConfiguration setAppGroup:@&quot;study-weex&quot;];
    [WXAppConfiguration setAppName:@&quot;hello-weex-ios&quot;];
    [WXAppConfiguration setAppVersion:@&quot;1.0.0&quot;];
    
    // 初始化 SDK
    [WXSDKEngine initSDKEnvironment];
    
    // 设置日志
    [WXLog setLogLevel: WXLogLevelAll];
    
    return YES;
}
</code></pre>

<h4 id="渲染页面">渲染页面</h4>

<pre><code class="language-Objective-C">#import &quot;ViewController.h&quot;
// 3rd
#import &lt;WeexSDK/WXSDKInstance.h&gt;

@interface ViewController ()

@property (nonatomic, strong) NSURL *url;
@property (nonatomic, strong) WXSDKInstance *instance;
@property (nonatomic, strong) UIView *weexView;
    
@end

@implementation ViewController

- (void)viewDidLoad
{
    [super viewDidLoad];
    
    _url = [NSURL URLWithString:@&quot;http://192.168.1.186:8080/dist/app.weex.js&quot;];
    
    _instance = [[WXSDKInstance alloc] init];
    _instance.viewController = self;
    _instance.frame = self.view.frame;
    
    __weak typeof(self) weakSelf = self;
    _instance.onCreate = ^(UIView *view) {
        [weakSelf.weexView removeFromSuperview];
        weakSelf.weexView = view; // 官方文档里少了这句，会导致看不到界面
        [weakSelf.view addSubview:weakSelf.weexView];
    };
    
    _instance.onFailed = ^(NSError *error) {
        // process failure
    };
    
    _instance.renderFinish = ^ (UIView *view) {
        // process renderFinish
    };
    [_instance renderWithURL:self.url options:@{@&quot;bundleUrl&quot;:[self.url absoluteString]} data:nil];
}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (void)dealloc
{
    // 销毁掉 Weex instance，释放内存，避免造成内存泄露
    [_instance destroyInstance];
}

@end
</code></pre>

<h3 id="hello-weex-for-android">hello-weex for Android</h3>

<h4 id="新建工程-设置依赖">新建工程，设置依赖</h4>

<p>app/build.gradle</p>

<pre><code>apply plugin: 'com.android.application'

android {
    compileSdkVersion 23
    buildToolsVersion &quot;25.0.2&quot;
    defaultConfig {
        applicationId &quot;android.neegle.net.helloweexandroid&quot;
        minSdkVersion 15
        targetSdkVersion 23
        versionCode 1
        versionName &quot;1.0&quot;
        testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}

dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', {
        exclude group: 'com.android.support', module: 'support-annotations'
    })
    compile 'com.android.support:appcompat-v7:23.1.1'
    compile 'com.android.support:recyclerview-v7:23.1.1'
    compile 'com.android.support:support-v4:23.1.1'
    compile 'com.android.support:appcompat-v7:23.1.1'
    compile 'com.alibaba:fastjson:1.1.46.android'
    compile 'com.taobao.android:weex_sdk:0.10.0'  // 0.10.0 以上版本才支持 Vue.js
    testCompile 'junit:junit:4.12'
}
</code></pre>

<h4 id="新建-imageadapter">新建 ImageAdapter</h4>

<pre><code class="language-Java">import android.widget.ImageView;

import com.taobao.weex.adapter.IWXImgLoaderAdapter;
import com.taobao.weex.common.WXImageStrategy;
import com.taobao.weex.dom.WXImageQuality;

/**
 * Created by jiyixuan on 2017/3/29.
 */

public class ImageAdapter implements IWXImgLoaderAdapter {

    @Override
    public void setImage(String url, ImageView view, WXImageQuality quality, WXImageStrategy strategy) {
        //实现你自己的图片下载。
    }
}
</code></pre>

<h4 id="新建-weexapplication">新建 WeexApplication</h4>

<pre><code class="language-Java">import android.app.Application;

import com.taobao.weex.InitConfig;
import com.taobao.weex.WXSDKEngine;
import com.taobao.weex.common.WXException;

/**
 * Created by jiyixuan on 2017/3/29.
 */

public class WeexApplication extends Application {

    @Override
    public void onCreate() {
        super.onCreate();
        InitConfig config = new InitConfig.Builder().setImgAdapter(new ImageAdapter()).build();
        WXSDKEngine.initialize(this, config);
    }
}
</code></pre>

<h4 id="修改-androidmanifest-xml-启用-weexapplication">修改 AndroidManifest.xml 启用 WeexApplication</h4>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    package=&quot;android.neegle.net.helloweexandroid&quot;&gt;

    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;/&gt;

    &lt;application
        android:name=&quot;.WeexApplication&quot;
        android:allowBackup=&quot;true&quot;
        android:icon=&quot;@mipmap/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot;
        android:supportsRtl=&quot;true&quot;
        android:theme=&quot;@style/AppTheme&quot;&gt;
        &lt;activity android:name=&quot;.MainActivity&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
    &lt;/application&gt;

&lt;/manifest&gt;
</code></pre>

<h4 id="mainactivity">MainActivity</h4>

<pre><code class="language-Java">package android.neegle.net.helloweexandroid;

import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;

import com.taobao.weex.IWXRenderListener;
import com.taobao.weex.WXSDKInstance;
import com.taobao.weex.common.WXRenderStrategy;
import com.taobao.weex.utils.WXFileUtils;

import java.util.HashMap;
import java.util.Map;

public class MainActivity extends AppCompatActivity implements IWXRenderListener {

    private static final String WEB_URL=&quot;http://192.168.1.186:8080/dist/app.weex.js&quot;;
    WXSDKInstance mWXSDKInstance;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        mWXSDKInstance = new WXSDKInstance(this);
        mWXSDKInstance.registerRenderListener(this);

        Map&lt;String, Object&gt; options = new HashMap&lt;&gt;();
        // 加载服务器 js
//        options.put(WXSDKInstance.BUNDLE_URL, WEB_URL);
//        mWXSDKInstance.render(&quot;WXSample&quot;,WEB_URL,options, null, WXRenderStrategy.APPEND_ONCE);
        // 加载本地 js
        options.put(WXSDKInstance.BUNDLE_URL, &quot;file://build/hello.js&quot;);
        mWXSDKInstance.render(&quot;WXSample&quot;,WXFileUtils.loadAsset(&quot;build/app.weex.js&quot;, this),options, null, WXRenderStrategy.APPEND_ONCE);
    }

    @Override
    public void onViewCreated(WXSDKInstance instance, View view) {
        setContentView(view);
    }

    @Override
    public void onRenderSuccess(WXSDKInstance instance, int width, int height) {
    }
    @Override
    public void onRefreshSuccess(WXSDKInstance instance, int width, int height) {
    }
    @Override
    public void onException(WXSDKInstance instance, String errCode, String msg) {
    }

    @Override
    protected void onResume() {
        super.onResume();
        if(mWXSDKInstance!=null){
            mWXSDKInstance.onActivityResume();
        }
    }

    @Override
    protected void onPause() {
        super.onPause();
        if(mWXSDKInstance!=null){
            mWXSDKInstance.onActivityPause();
        }
    }
    @Override
    protected void onStop() {
        super.onStop();
        if(mWXSDKInstance!=null){
            mWXSDKInstance.onActivityStop();
        }
    }
    @Override
    protected void onDestroy() {
        super.onDestroy();
        if(mWXSDKInstance!=null){
            mWXSDKInstance.onActivityDestroy();
        }
    }
}
</code></pre>

<h2 id="参考资料">参考资料</h2>

<ul>
<li><a href="http://weex.apache.org/cn/">weex 官网</a></li>
<li><a href="https://vuejs.org">Vue.js</a></li>
<li><a href="http://www.jianshu.com/p/41cde2c62b81">Weex 是如何在 iOS 客户端上跑起来的</a> by 一缕殇流化隐半边冰霜 2017</li>
</ul>
    </div>
            
    <div class="disqus">
        
    </div>

<div class="container has-text-centered top-pad">
<hr>
<a href="/blog/hello-weex-20170403/#top">TOP</a>
<hr>
</div>

<div class="section" id="footer">
    <div class="container has-text-centered">
        
        © 2017 计轶轩 · Powered by the 
        <span><a href="https://github.com/vickylaixy/hugo-theme-introduction" target="_blank">Introduction</a> theme for <a href="http://gohugo.io/" target="_blank">Hugo</a>. 
        
    </div>
</div>
</div>
</div>



<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

<script type="application/javascript" src="//cdn.jsdelivr.net/jquery.scrollto/2.1.2/jquery.scrollTo.min.js"></script>

<script type="text/javascript" src=/js/init.js></script>
<script>
  
  $('a[href^="\/blog\/hello-weex-20170403\/#"]').click(function(e) {
    
    e.preventDefault();
    
    
    $(window).stop(true).scrollTo(this.hash, {duration:500, interrupt:false});
  });
  </script>